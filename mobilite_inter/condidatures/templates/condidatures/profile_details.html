{% extends 'condidatures/base.html' %}

{% block title %}Profil - {{ request.user.username }}{% endblock %}

{% block extra_css %}
<style>
#searchOffers::placeholder {
    color: var(--primary-color) !important;
    opacity: 0.8;
    font-weight: 500;
}

#searchOffers::-webkit-input-placeholder {
    color: var(--primary-color) !important;
    opacity: 0.8;
    font-weight: 500;
}

#searchOffers::-moz-placeholder {
    color: var(--primary-color) !important;
    opacity: 0.8;
    font-weight: 500;
}

#searchOffers:-ms-input-placeholder {
    color: var(--primary-color) !important;
    opacity: 0.8;
    font-weight: 500;
}
</style>
{% endblock %}

{% block content %}
<div class="container mt-8">
    <!-- Welcome Header -->
    <div class="card mb-8">
        <div class="card-header">
            <h1 style="margin: 0; display: flex; align-items: center; gap: 0.75rem;">
                <i class="fas fa-user-circle" style="color: var(--primary-color); font-size: 2rem;"></i>
                Bienvenue, {{ request.user.username }} !
            </h1>
        </div>
    </div>

    <!-- Profile Information -->
    <div class="card mb-8">
        <div class="card-header">
            <h2 style="margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-id-card" style="color: var(--primary-color);"></i>
                Informations du Profil
            </h2>
        </div>
        <div class="card-body">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="card red-gradient" style="color: white; border: 2px solid var(--black);">
                    <div class="card-body">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="width: 60px; height: 60px; background: var(--black); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold; color: white;">
                                {{ request.user.username|first|upper }}
                            </div>
                            <div>
                                <h3 style="margin: 0; font-size: 1.25rem; color: var(--black) !important;">{{ request.user.username }}</h3>
                                <p style="margin: 0; opacity: 0.8; color: var(--black) !important;">Étudiant</p>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="opacity: 0.8; color: var(--white) !important;">Identifiant:</span>
                            <span style="background: var(--white); padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-family: monospace; color: white;">{{ profile.identifiant }}</span>
                        </div>
                    </div>
                </div>

                <div class="card" style="background: var(--black); color: white; border: 2px solid var(--primary-color);">
                    <div class="card-body">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <i class="fas fa-chart-line" style="font-size: 2rem; opacity: 0.8; color: var(--primary-color);"></i>
                            <div>
                                <h3 style="margin: 0; font-size: 1.25rem;">Moyenne</h3>
                                <p style="margin: 0; opacity: 0.8;">Score académique</p>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <span style="font-size: 2rem; font-weight: bold; background: var(--primary-color); padding: 0.5rem 1rem; border-radius: 0.5rem; display: inline-block; color: white;">
                                {{ profile.moyenne }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                <div class="card">
                    <div class="card-body">
                        <h3 style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem; color: var(--primary-color);">
                            <i class="fas fa-language"></i>
                            Langues
                        </h3>
                        <p style="background: var(--gray-100); padding: 1rem; border-radius: var(--border-radius); margin: 0;">{{ profile.langues }}</p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <h3 style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem; color: var(--success-color);">
                            <i class="fas fa-running"></i>
                            Activités
                        </h3>
                        <p style="background: var(--gray-100); padding: 1rem; border-radius: var(--border-radius); margin: 0;">{{ profile.activites|default:"Aucune activité" }}</p>
                    </div>
                </div>
            </div>

            {% if profile.certificats %}
            <div class="card mt-6">
                <div class="card-body">
                    <h3 style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem; color: var(--warning-color);">
                        <i class="fas fa-certificate"></i>
                        Certificats
                    </h3>
                    <p style="background: var(--gray-100); padding: 1rem; border-radius: var(--border-radius); margin: 0;">{{ profile.certificats }}</p>
                </div>
            </div>
            {% endif %}
        </div>
        </div>

    <!-- Action Buttons -->
    <div class="card mb-8">
        <div class="card-body text-center">
            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                <a href="{% url 'stats' %}" class="btn btn-primary">
                    <i class="fas fa-chart-bar"></i>
                    Voir mes Statistiques
                </a>
                <a href="{% url 'logout' %}" class="btn btn-outline">
                    <i class="fas fa-sign-out-alt"></i>
                    Déconnexion
                </a>
            </div>
        </div>
    </div>

    <!-- Available Offers -->
    <div class="card">
        <div class="card-header">
            <h2 style="margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-briefcase" style="color: var(--success-color);"></i>
                Offres de Stage Disponibles
            </h2>
        </div>
        <div class="card-body">
            <!-- Search Field -->
            <div style="margin-bottom: 2rem; padding: 1rem; background: var(--gray-50); border-radius: 8px; border: 2px solid var(--primary-color);">
                <h3 style="margin: 0 0 1rem 0; color: var(--black); text-align: center; font-size: 1.1rem;">
                    <i class="fas fa-search" style="color: var(--primary-color); margin-right: 0.5rem;"></i>
                    Rechercher une offre
                </h3>
                <div style="position: relative; max-width: 500px; margin: 0 auto;">
                    <div style="position: relative;">
                        <i class="fas fa-briefcase" style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--primary-color); font-size: 1.2rem;"></i>
                        <input type="text" id="searchOffers" placeholder="Tapez ici pour rechercher (ex: mobilite a londre)" 
                               style="width: 100%; padding: 1.2rem 1rem 1.2rem 3.5rem; border: 3px solid var(--primary-color); border-radius: 12px; font-size: 1.1rem; background: var(--white); color: var(--black); outline: none; transition: all 0.3s ease; font-weight: 500; box-shadow: var(--shadow-md);"
                               onfocus="this.style.borderColor='var(--black)'; this.style.boxShadow='0 0 0 4px rgba(220, 38, 38, 0.2)'; this.style.transform='scale(1.02)'"
                               onblur="this.style.borderColor='var(--primary-color)'; this.style.boxShadow='var(--shadow-md)'; this.style.transform='scale(1)'">
                    </div>
                </div>
            </div>
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        <i class="fas fa-{% if message.tags == 'success' %}check-circle{% elif message.tags == 'error' %}exclamation-circle{% elif message.tags == 'warning' %}exclamation-triangle{% else %}info-circle{% endif %}"></i>
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}

            {% if offres %}
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for offre in offres %}
                    <div class="card red-border" style="transition: transform 0.2s, box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='var(--shadow-lg)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='var(--shadow)';">
                        <div class="card-header red-gradient" style="color: white; border-bottom: 2px solid var(--black);">
                            <h3 style="margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-briefcase"></i>
                                {{ offre.titre }}
                            </h3>
                        </div>
                        <div class="card-body">
                            <div style="margin-bottom: 1rem;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <i class="fas fa-building" style="color: var(--primary-color);"></i>
                                    <strong>{{ offre.entreprise }}</strong>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <i class="fas fa-map-marker-alt" style="color: var(--warning-color);"></i>
                                    <span>{{ offre.localisation }}</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                                    <i class="fas fa-calendar" style="color: var(--success-color);"></i>
                                    <span>Du {{ offre.date_debut|date:"d/m/Y" }} au {{ offre.date_fin|date:"d/m/Y" }}</span>
                                </div>
                            </div>
                            <p style="color: var(--gray-600); margin-bottom: 1rem; line-height: 1.5;">{{ offre.description|truncatewords:20 }}</p>
                            <a href="{% url 'postuler_offre' offre.id %}" class="btn btn-success" style="width: 100%;">
                                <i class="fas fa-paper-plane"></i>
                                Postuler
                            </a>
                        </div>
            </div>
            {% endfor %}
                </div>
            {% else %}
                <div class="text-center" style="padding: 3rem; color: var(--gray-500);">
                    <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 1rem; display: block; opacity: 0.5;"></i>
                    <h3 style="margin-bottom: 0.5rem;">Aucune offre disponible</h3>
                    <p style="margin: 0; opacity: 0.8;">Il n'y a actuellement aucune offre de stage disponible.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchOffers');
    const offerCards = document.querySelectorAll('.card.red-border');
    
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            
            offerCards.forEach(card => {
                const title = card.querySelector('h3').textContent.toLowerCase();
                const company = card.querySelector('strong').textContent.toLowerCase();
                const location = card.querySelector('span').textContent.toLowerCase();
                const description = card.querySelector('p').textContent.toLowerCase();
                
                const matches = title.includes(searchTerm) || 
                              company.includes(searchTerm) || 
                              location.includes(searchTerm) || 
                              description.includes(searchTerm);
                
                if (matches || searchTerm === '') {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });
    }
});
</script>
{% endblock %}
