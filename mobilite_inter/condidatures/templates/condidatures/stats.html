{% extends 'condidatures/base.html' %}

{% block title %}Statistiques - {{ request.user.username }}{% endblock %}

{% block content %}
<div class="container mt-8">
    <!-- Header -->
    <div class="card mb-8">
        <div class="card-header">
            <h1 style="margin: 0; display: flex; align-items: center; gap: 0.75rem;">
                <i class="fas fa-chart-bar" style="color: var(--primary-color);"></i>
                Vos Statistiques
            </h1>
        </div>
    </div>

    <!-- Statistics Overview -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="card red-gradient" style="color: white; border: 2px solid var(--black);">
            <div class="card-body text-center">
                <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 0.5rem; opacity: 0.8;"></i>
                <h3 style="margin: 0; font-size: 2rem;">{{ students_data|length }}</h3>
                <p style="margin: 0; opacity: 0.8;">Étudiants</p>
            </div>
        </div>
        
        <div class="card" style="background: var(--black); color: white; border: 2px solid var(--primary-color);">
            <div class="card-body text-center">
                <i class="fas fa-file-alt" style="font-size: 2rem; margin-bottom: 0.5rem; opacity: 0.8; color: var(--primary-color);"></i>
                <h3 style="margin: 0; font-size: 2rem;">{{ candidatures|length }}</h3>
                <p style="margin: 0; opacity: 0.8;">Candidatures</p>
            </div>
        </div>
        
        <div class="card" style="background: var(--white); color: var(--black); border: 2px solid var(--black);">
            <div class="card-body text-center">
                <i class="fas fa-chart-line" style="font-size: 2rem; margin-bottom: 0.5rem; opacity: 0.8; color: var(--primary-color);"></i>
                <h3 style="margin: 0; font-size: 2rem; color: var(--black);">{{ profile.moyenne|default:"N/A" }}</h3>
                <p style="margin: 0; opacity: 0.8; color: var(--black);">Moyenne</p>
            </div>
        </div>
        
        <div class="card" style="background: var(--primary-color); color: white; border: 2px solid var(--black);">
            <div class="card-body text-center">
                <i class="fas fa-trophy" style="font-size: 2rem; margin-bottom: 0.5rem; opacity: 0.8;"></i>
                <h3 style="margin: 0; font-size: 2rem;">{{ profile.rang|default:"N/A" }}</h3>
                <p style="margin: 0; opacity: 0.8;">Rang</p>
            </div>
        </div>
    </div>

    <!-- Students Data Table -->
    <div class="card mb-8">
        <div class="card-header">
            <h2 style="margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-user-graduate" style="color: var(--primary-color);"></i>
                Classement des Étudiants
            </h2>
        </div>
        <div class="card-body" style="padding: 0;">
            {% if students_data %}
                <div style="overflow-x: auto;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th><i class="fas fa-user"></i> Nom d'utilisateur</th>
                                <th><i class="fas fa-id-card"></i> Identifiant</th>
                                <th><i class="fas fa-chart-line"></i> Moyenne</th>
                                <th><i class="fas fa-language"></i> Langues</th>
                                <th><i class="fas fa-running"></i> Activités</th>
                                <th><i class="fas fa-star"></i> Score Final</th>
                                <th><i class="fas fa-calendar"></i> Date de Calcul</th>
                                <th><i class="fas fa-trophy"></i> Rang</th>
                                <th><i class="fas fa-calendar-alt"></i> Année</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for student in students_data %}
                            <tr {% if student.username == request.user.username %}style="background: linear-gradient(135deg, rgba(37, 99, 235, 0.1), rgba(29, 78, 216, 0.1)); border-left: 4px solid var(--primary-color);"{% endif %}>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <div style="width: 32px; height: 32px; background: {% if student.username == request.user.username %}var(--primary-color){% else %}var(--gray-400){% endif %}; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                            {{ student.username|first|upper }}
                                        </div>
                                        <span {% if student.username == request.user.username %}style="font-weight: bold; color: var(--primary-color);"{% endif %}>{{ student.username }}</span>
                                        {% if student.username == request.user.username %}
                                            <span style="background: var(--primary-color); color: white; padding: 0.25rem 0.5rem; border-radius: 1rem; font-size: 0.75rem; font-weight: bold;">VOUS</span>
                                        {% endif %}
                                    </div>
                                </td>
                                <td><span style="background: var(--gray-100); padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-family: monospace;">{{ student.identifiant }}</span></td>
                                <td>
                                    <span style="background: {% if student.moyenne >= 15 %}var(--success-color){% elif student.moyenne >= 12 %}var(--warning-color){% else %}var(--danger-color){% endif %}; color: white; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-weight: bold;">
                                        {{ student.moyenne|default:"N/A" }}
                                    </span>
                                </td>
                                <td>{{ student.langues|default:"N/A" }}</td>
                                <td>{{ student.activites|default:"Aucune activité" }}</td>
                                <td>
                                    <span style="background: var(--primary-color); color: white; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-weight: bold;">
                                        {{ student.score_final|default:"N/A" }}
                                    </span>
                                </td>
                                <td>{{ student.date_calcul|date:"d/m/Y" }}</td>
                                <td>
                                    <span style="background: var(--gray-200); padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-weight: bold;">
                                        {{ student.rang|default:"N/A" }}
                                    </span>
                                </td>
                                <td>{{ student.annee }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="text-center" style="padding: 3rem; color: var(--gray-500);">
                    <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 1rem; display: block; opacity: 0.5;"></i>
                    <h3 style="margin-bottom: 0.5rem;">Aucune donnée disponible</h3>
                    <p style="margin: 0; opacity: 0.8;">Les statistiques ne sont pas encore disponibles.</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Applications Section -->
    <div class="card mb-8">
        <div class="card-header">
            <h2 style="margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-file-alt" style="color: var(--success-color);"></i>
                Vos Candidatures
            </h2>
        </div>
        <div class="card-body" style="padding: 0;">
            {% if candidatures %}
                <div style="overflow-x: auto;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th><i class="fas fa-briefcase"></i> Titre de l'offre</th>
                                <th><i class="fas fa-building"></i> Entreprise</th>
                                <th><i class="fas fa-map-marker-alt"></i> Lieu</th>
                                <th><i class="fas fa-calendar-plus"></i> Date de début</th>
                                <th><i class="fas fa-calendar-minus"></i> Date de fin</th>
                                <th><i class="fas fa-info-circle"></i> Statut</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for candidature in candidatures %}
                            <tr>
                                <td><strong>{{ candidature.offre.titre }}</strong></td>
                                <td>{{ candidature.offre.entreprise }}</td>
                                <td>{{ candidature.offre.localisation }}</td>
                                <td>{{ candidature.offre.date_debut|date:"d/m/Y" }}</td>
                                <td>{{ candidature.offre.date_fin|date:"d/m/Y" }}</td>
                                <td>
                                    <span style="background: {% if candidature.statut == 'acceptee' %}var(--success-color){% elif candidature.statut == 'refusee' %}var(--danger-color){% else %}var(--warning-color){% endif %}; color: white; padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.75rem; font-weight: bold; text-transform: uppercase;">
                                        {{ candidature.statut|default:"En attente" }}
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="text-center" style="padding: 3rem; color: var(--gray-500);">
                    <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 1rem; display: block; opacity: 0.5;"></i>
                    <h3 style="margin-bottom: 0.5rem;">Aucune candidature</h3>
                    <p style="margin-bottom: 1.5rem; opacity: 0.8;">Vous n'avez envoyé aucune candidature pour le moment.</p>
                    <a href="{% url 'profile_details' %}" class="btn btn-primary">
                        <i class="fas fa-briefcase"></i>
                        Voir les offres disponibles
                    </a>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="card">
        <div class="card-body text-center">
            <a href="{% url 'profile_details' %}" class="btn btn-primary">
                <i class="fas fa-arrow-left"></i>
                Retour au Profil
            </a>
        </div>
    </div>
</div>
{% endblock %}
